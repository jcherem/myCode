kernel VectorscopeKernel : ImageComputationKernel<ePixelWise>
{
  Image<eRead, eAccessRanged2D, eEdgeClamped> src;  // the input image
  Image<eWrite> dst;  // the output image

  param:
    float scale;  // a scale factor for adjusting the vectorscope display

  void define() {
    defineParam(scale, "Scale", 1.0f);
  }

  void init() {
    // You might want to initialize some variables here
  }

  void process() {
    float4 srcPixel = src();  // get the source pixel

    // Convert the source pixel to YCbCr color space
    float Y = 0.299f * srcPixel.r + 0.587f * srcPixel.g + 0.114f * srcPixel.b;
    float Cb = -0.1687f * srcPixel.r - 0.3313f * srcPixel.g + 0.5f * srcPixel.b + 0.5f;
    float Cr = 0.5f * srcPixel.r - 0.4187f * srcPixel.g - 0.0813f * srcPixel.b + 0.5f;

    // Scale and shift the Cb and Cr components for display
    float x = Cb * scale + 0.5f;
    float y = Cr * scale + 0.5f;

    // Write the result to the output image
    dst() = float4(x, y, 0.0f, 1.0f);
  }
};
